#!/usr/bin/env python

"""hcarch2log: ...
"""

__author__      = "Joel Dubowy"
__copyright__   = "Copyright (c) 2015 AirFire, PNW, USFS"

import json
import os
import sys
from argparse import ArgumentParser, RawTextHelpFormatter

def main():
    parser = ArgumentParser()
    parser.add_argument('room_dir')
    args  = parser.parse_args()

    d = os.path.expanduser(args.room_dir)
    for filename in sorted(os.listdir(d)):
        filepathname = os.path.join(d, filename)
        if os.path.isfile(filepathname):
            with open(filepathname, 'r') as f:
                j = json.loads(f.read())
                for log in j:
                    line = "{} - {}:  {}\n".format(log['date'],
                        log['from']['name'], log['message'])
                    sys.stdout.write(line)
        else:
            sys.stderr.write('Skipping {}'.format(filename))

if __name__ == "__main__":
    main()
